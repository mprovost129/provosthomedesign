{% extends "base.html" %}
{% load static %}

{% block title %}{{ about.title|default:"About" }} â€¢ {{ about.company|default:"Provost Home Design" }}{% endblock %}

{% block content %}
<div class="container-lg py-4">

  <!-- Header -->
  <header class="mb-4">
    <h1 class="h3 mb-1">{{ about.title|default:"About" }}</h1>
    {% if about.subtitle %}<p class="text-muted mb-0">{{ about.subtitle }}</p>{% endif %}
  </header>

  <!-- Two columns: text (left), photos (right) -->
  <div class="row g-4 align-items-start">
    <!-- LEFT COLUMN -->
    <div class="col-md-6 col-lg-7">
      <!-- About card -->
      <div class="bg-white border rounded-3 shadow p-4">
        {% if about.owner_name or about.company %}
          <h2 class="h5 mb-3">{{ about.owner_name|default:about.company }}</h2>
        {% endif %}

        {# Prefer explicit list of paragraphs if provided #}
        {% if about.paragraphs %}
          {% for p in about.paragraphs %}
            <p class="mb-3">{{ p }}</p>
          {% endfor %}
        {% else %}
          {# Fall back to a single text blob from admin and convert newlines to paragraphs #}
          {% with raw=about.body|default:about.text|default:about.description|default:about.content %}
            {% if raw %}
              {{ raw|linebreaks }}
            {% else %}
              <p class="text-muted mb-0">About content will appear here once published.</p>
            {% endif %}
          {% endwith %}
        {% endif %}

        {% if about.highlights %}
          <hr class="my-4">
          <h3 class="h6 mb-2">Highlights</h3>
          <div class="d-flex flex-wrap gap-2">
            {% for h in about.highlights %}
              <span class="badge text-bg-light border">{{ h }}</span>
            {% endfor %}
          </div>
        {% endif %}

        {% if about.badges %}
          <div class="mt-3 d-flex flex-wrap gap-2">
            {% for b in about.badges %}
              <span class="badge text-bg-secondary">{{ b }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Knowledge & Skills -->
      {% if about.knowledge_skills %}
        <section class="mt-4">
          <div class="bg-white border rounded-3 shadow p-4">
            <h2 class="h5 mb-3">Knowledge &amp; Skills</h2>
            <div class="row">
              {% with ks=about.knowledge_skills %}
                <div class="col-sm-6">
                  <ul class="mb-0">
                    {% for item in ks %}
                      {% if forloop.counter0|divisibleby:2 %}
                        <li class="mb-1">{{ item }}</li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
                <div class="col-sm-6">
                  <ul class="mb-0">
                    {% for item in ks %}
                      {% if not forloop.counter0|divisibleby:2 %}
                        <li class="mb-1">{{ item }}</li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              {% endwith %}
            </div>
          </div>
        </section>
      {% endif %}

      <!-- Licenses -->
      {% if about.licenses %}
        <section class="mt-4">
          <div class="bg-white border rounded-3 shadow p-4">
            <h2 class="h5 mb-3">Licenses &amp; Registrations</h2>
            <ul class="list-group">
              {% for lic in about.licenses %}
                <li class="list-group-item d-flex align-items-center">
                  <i class="bi bi-patch-check-fill me-2" aria-hidden="true"></i>
                  <span>{{ lic }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
        </section>
      {% endif %}

      <div class="mt-4 d-flex gap-2">
        <a href="{% url 'pages:contact' %}" class="btn btn-primary">Contact us</a>
        <a href="{% url 'plans:plan_list' %}" class="btn btn-outline-primary">Browse plans</a>
      </div>
    </div>

    <!-- RIGHT COLUMN: photos -->
    <div class="col-md-6 col-lg-5">
      <div class="bg-white border rounded-3 shadow p-3">
        {% if about.photos and about.photos|length > 0 %}
          {% with ph=about.photos.0 %}
            {% with src=ph.url|default:ph %}
              <img src="{{ src }}"
                   alt="{{ about.owner_name|default:about.company|default:'Company' }} photo"
                   class="w-100 h-auto rounded border mb-2 d-block"
                   loading="lazy" decoding="async">
            {% endwith %}
          {% endwith %}

          {% if about.photos|length > 1 %}
            <div class="row g-2">
              {% for ph in about.photos|slice:"1:" %}
                {% with src=ph.url|default:ph %}
                  <div class="col-6">
                    <img src="{{ src }}"
                         alt="Additional photo"
                         class="w-100 h-auto rounded border d-block"
                         loading="lazy" decoding="async">
                  </div>
                {% endwith %}
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <div class="ratio ratio-16x9 bg-body-tertiary rounded d-flex align-items-center justify-content-center">
            <span class="text-muted">Photo coming soon</span>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Testimonials (optional) -->
{% if testimonials %}
  <section class="mt-4">
    <div class="bg-white border rounded-3 shadow p-4">
      <h2 class="h5 mb-3">What clients say</h2>
      <div class="row g-3">
        {% for t in testimonials|slice:":3" %}
          <div class="col-md-6 col-lg-4">
            <div class="bg-white border rounded-3 shadow-sm p-3 h-100">
              <div class="d-flex justify-content-between align-items-center">
                <strong>{{ t.name }}</strong>
                <span class="badge text-bg-success-subtle text-success border">Rating: {{ t.rating }}/5</span>
              </div>
              <p class="mb-1 mt-2">{{ t.message|linebreaksbr }}</p>
              <small class="text-muted">{{ t.created_at|date:"M j, Y" }}</small>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

</div>
{% endblock %}
